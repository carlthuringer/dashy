<!DOCTYPE html>
<html>
  <head>
    <title>Dashboard</title>
    <link rel="stylesheet/less" href="css/style.css" type="text/css" />
    <link rel="icon" type="image/png" href="images/success.png" />
    <link href='http://fonts.googleapis.com/css?family=Droid+Sans' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <div id="demo">
      <p>This is a demo, play with the buttons!
        <a id="random_failure" class="button" href="#">Random failure</a>
        <a id="random_success" class="button" href="#">Random success</a>
        <a id="random_continuing_success" class="button" href="#">Random Continuing Success</a>
      </p>
    </div>
    <div id="progress"></div>
    <div class="dashboard">
      <h1 id="title"></h1>
      <ul id="projects" class="projects"></ul>
      <ul id="pings"></ul>
    </div>
    <div id="audio">
      <audio id="continuing_success" src=""></audio>
      <audio id="success" src=""></audio>
      <audio id="building" src=""></audio>
      <audio id="failure" src=""></audio>
    </div>
    <div id="scripts">
      <script src="javascripts/frameworks/less-1.0.18.min.js"></script>
      <script src="javascripts/frameworks/jquery-1.5.min.js"></script>
      <script src="javascripts/frameworks/jquery-css-transform.js"></script>
      <script src="javascripts/frameworks/jquery-animate-css-rotate-scale.js"></script>
      <script src="javascripts/frameworks/jquery-ui-1.8.5.custom.min.js"></script>
      <script src="javascripts/frameworks/jquery.quicksand.min.js"></script>
      <script src="javascripts/frameworks/jquery.tmpl.min.js"></script>
      <script src="javascripts/jquery_plugins.js"></script>
      <script src="javascripts/audio.js"></script>
      <script src="javascripts/ping.js"></script>
      <script src="javascripts/project.js"></script>
      <script src="javascripts/current_build.js"></script>
      <script src="javascripts/build_historian.js"></script>
      <script src="javascripts/config.js"></script>
      <script src="javascripts/dashboard.js"></script>
      <script src="javascripts/status_parser.js"></script>
      <script>
        var dashboard = new Dashboard(config);
        dashboard.applyConfigSettings();
        dashboard.loadPings();
        dashboard.loadProjects();
        dashboard.refresh();

        // setInterval(function() {
        //   dashboard.refresh();
        // }, dashboard.refreshInterval);

        function getRandomProject() {
          return dashboard.projects[Math.floor(Math.random()*5)];
        }

        $('#random_failure').click(function(ev) {
          ev.preventDefault();
          var project = getRandomProject();
          project.responseHandler({ 
            status:'building',
            commitMessage:'Added that killer new feature... Really hope it doesn\'t break'
          });

          setTimeout(function() {
            project.responseHandler({
              status:'failure',
              duration:Math.floor(Math.random()*1000000)
            });
          }, 5000);
        });

        $('#random_success').click(function(ev) {
          ev.preventDefault();
          var project = getRandomProject();
          project.responseHandler({
            status:'building',
            commitMessage:'Finally finishing up mega feature. This one is solid.'
          });

          setTimeout(function() {
            project.responseHandler({
              status:'success',
              duration:Math.floor(Math.random()*1000000)
            });
          }, 5000);
        });

        $('#random_continuing_success').click(function(ev) {
          ev.preventDefault();
          var project = getRandomProject();
          $.each([1,2,3,4], function() {
            project.buildHistorian.addState('success');
          });

          project.responseHandler({
            status:'building',
            commitMessage:'We are seriously on a roll with this project. Another feature down!'
          });

          setTimeout(function() {
            project.responseHandler({
              status:'success',
              duration:Math.floor(Math.random()*1000000)
            });
          }, 5000);
        });
      </script>
    </div>
  </body>
</html>
